var hive_loader = require('hive-loader');
var _ = require('underscore');
var util = require('util');
var _DEBUG = false;

/**
 *
 * This handler listens for action configurations; it is attached to the layout loader.
 *
 * @param mixins
 * @param config
 * @param cb
 * @return {*}
 */

module.exports = function (mixins, config, cb) {

	var _mixins = {
		name:    'config_handler',
		respond: function (params) {
			var self = this;
			try {
				var configs = require(params.file_path);
				self._config.setAll(configs);
				var name = this.get_config('name');
				if ( name){
					this.name = name;
				}
				loader.core().add_static(this, params.gate.latch());
			} catch(e){
				console.log('error reading config file %s: %s', params.file_path, e);
			}

		}
	};

	var loader =  hive_loader.handler(
		[ _mixins, mixins],
		[
			{dir: false, name_filter: /(.*_)?config\.json$/i},
			config
		],
		cb);
	return loader;
}